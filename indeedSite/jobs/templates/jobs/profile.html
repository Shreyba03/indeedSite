{% extends "base.html" %}

{% block title %}IndeedLite - Find Your Next Career Opportunity{% endblock %}

{% block content %}

  <div class="container mt-5">
    <!-- Profile Header -->
    <div class="section-header">
      <i class="fas fa-user"></i>
      {{ template_data.owner.username }}'s Profile
    </div>
    <div class="section-content">
      <!-- Profile Overview -->
      <div class="row mb-4">
        <div class="col-lg-8">
          <div class="profile-card">
            <div class="profile-avatar mb-3">
              {{ template_data.owner.username|first|upper }}
            </div>
            <h1 class="text-gt-navy mb-2">{{ template_data.owner.username }}</h1>
            {% if user.profile.is_recruiter %}
              <p class="text-muted mb-3">Works at {{ template_data.profile.company }}!</p>     
            {% else %}
              <p class="text-muted mb-3">{{ template_data.profile.headline|default:template_data.owner.username}}</p>     
            {% endif %}   
            
            <!-- Contact Information -->
            <div class="row">
              {% if template_data.profile.show_email and template_data.profile.email %}
                <div class="col-md-6 mb-2">
                  <i class="fas fa-envelope text-gt-gold me-2"></i>
                  <a href="mailto:{{ template_data.profile.email }}" class="text-decoration-none">
                    {{ template_data.profile.email }}
                  </a>
                </div>
              {% endif %}
              {% if template_data.profile.show_phone and template_data.profile.phone_number %}
                <div class="col-md-6 mb-2">
                  <i class="fas fa-phone text-gt-gold me-2"></i>
                  <a href="tel:{{ template_data.profile.phone_number }}" class="text-decoration-none">
                    {{ template_data.profile.phone_number }}
                  </a>
                </div>
              {% endif %}
            </div>
          </div>
        </div>
        
        <div class="col-lg-4">
          <div class="card">
            <div class="card-header bg-gt-gold text-white">
              <h5 class="mb-0">
                <i class="fas fa-cog"></i>
                Quick Actions
              </h5>
            </div>
            <div class="card-body">
              {% if template_data.owner.id == request.user.id %}
                <div class="d-grid gap-2">
                  <a href="{% url 'profile.edit' template_data.owner.id %}" class="btn btn-primary">
                    <i class="fas fa-edit"></i>
                    Edit Profile
                  </a>
                  <a href="{% url 'skills.edit' template_data.owner.id %}" class="btn btn-outline-primary">
                    <i class="fas fa-tools"></i>
                    Edit Skills
                  </a>
                  <a href="{% url 'experience.edit' template_data.owner.id %}" class="btn btn-outline-primary">
                    <i class="fas fa-briefcase"></i>
                    Edit Experience
                  </a>
                </div>
                {% else %}
                <!-- Message Button for viewing other users -->
                <div class="mt-3">
                  <a href="{% url 'job_inbox' template_data.owner.username %}" class="btn btn-success w-100">
                    <i class="fas fa-envelope"></i>
                    Message this User
                  </a>
                </div>
                <div class="mt-3">
                  <a href="{% url 'send_email' template_data.owner.id %}" class="btn btn-outline-primary w-100">
                    <i class="fas fa-envelope"></i>
                    Email this User
                  </a>
                </div>
              {% endif %}
              <div class="mt-3">
                <a href="{% url 'home.index' %}" class="btn btn-secondary w-100">
                  <i class="fas fa-home"></i>
                  Back to Home
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="section-header mt-4">
        <i class="fas fa-tools"></i>
        Skills & Expertise
      </div>
      <div class="section-content">
        {% if template_data.profile.skill_list.all %}
          <div class="row">
            {% for skill in template_data.profile.skill_list.all %}
              <div class="col-md-6 col-lg-4 mb-3">
                <div class="card h-100">
                  <div class="card-body text-center">
                    <h6 class="card-title text-gt-navy">{{ skill.name }}</h6>
                    <span class="badge bg-gt-gold">{{ skill.proficiency }}</span>
                  </div>
                </div>
              </div>
            {% endfor %}
          </div>
        {% elif template_data.profile.skills %}
          <div class="card">
            <div class="card-body">
              <p class="mb-0">{{ template_data.profile.skills }}</p>
            </div>
          </div>
        {% else %}
          <div class="alert alert-info text-center">
            <i class="fas fa-info-circle fa-2x mb-3 text-gt-gold"></i>
            <h5>No skills added yet</h5>
            <p>Skills help employers understand your capabilities and expertise.</p>
            {% if request.user.id == template_data.profile.user.id %}
              <a href="{% url 'skills.edit' template_data.profile.user.id %}" class="btn btn-primary">
                <i class="fas fa-plus"></i>
                Add Skills
              </a>
            {% endif %}
          </div>
        {% endif %}
      </div>

      <div class="section-header mt-4">
        <i class="fas fa-graduation-cap"></i>
        Education
      </div>
      <div class="section-content">
        {% if template_data.profile.education %}
          <div class="card">
            <div class="card-body">
              <p class="mb-0">{{ template_data.profile.education|linebreaks }}</p>
            </div>
          </div>
        {% else %}
          <div class="alert alert-info text-center">
            <i class="fas fa-graduation-cap fa-2x mb-3 text-gt-gold"></i>
            <h5>No education information added yet</h5>
            <p>Share your educational background to help employers understand your qualifications.</p>
            {% if request.user.id == template_data.profile.user.id %}
              <a href="{% url 'profile.edit' template_data.profile.user.id %}" class="btn btn-primary">
                <i class="fas fa-edit"></i>
                Add Education
              </a>
            {% endif %}
          </div>
        {% endif %}
      </div>

      <div class="section-header mt-4">
        <i class="fas fa-briefcase"></i>
        Work Experience
      </div>
      <div class="section-content">
        {% if template_data.profile.experience_list.all %}
          <div class="row">
            {% for exp in template_data.profile.experience_list.all %}
              <div class="col-lg-6 mb-4">
                <div class="card h-100">
                  <div class="card-body">
                    <h5 class="card-title text-gt-navy">{{ exp.position }}</h5>
                    <h6 class="card-subtitle mb-2 text-gt-gold">{{ exp.company }}</h6>
                    <p class="text-muted small mb-3">
                      <i class="fas fa-calendar text-gt-gold me-1"></i>
                      {{ exp.start_date|date:"M Y" }} -
                      {% if exp.is_current %}
                        Present
                      {% else %}
                        {{ exp.end_date|date:"M Y" }}
                      {% endif %}
                    </p>
                    <p class="card-text">{{ exp.description|linebreaks }}</p>
                  </div>
                </div>
              </div>
            {% endfor %}
          </div>
        {% else %}
          <div class="alert alert-info text-center">
            <i class="fas fa-briefcase fa-2x mb-3 text-gt-gold"></i>
            <h5>No work experience added yet</h5>
            <p>Share your professional experience to showcase your career journey.</p>
            {% if request.user.id == template_data.profile.user.id %}
              <a href="{% url 'experience.edit' template_data.profile.user.id %}" class="btn btn-primary">
                <i class="fas fa-plus"></i>
                Add Experience
              </a>
            {% endif %}
          </div>
        {% endif %}
      </div>

      {% if template_data.profile.location %}
        <div class="section-header mt-4">
          <i class="fas fa-map-marker-alt"></i>
          Location
        </div>
        <div class="section-content">
          <div class="card">
            <div class="card-body">
              <div class="d-flex align-items-center mb-3">
                <i class="fas fa-map-marker-alt text-gt-gold me-2 fa-2x"></i>
                <div>
                  <h5 class="mb-0">{{ template_data.profile.location }}</h5>
                  {% if template_data.profile.latitude and template_data.profile.longitude %}
                    <small class="text-muted">
                      <i class="fas fa-globe me-1"></i>
                      {{ template_data.profile.latitude|floatformat:4 }}, {{ template_data.profile.longitude|floatformat:4 }}
                    </small>
                  {% endif %}
                </div>
              </div>
              {% if template_data.profile.latitude and template_data.profile.longitude %}
                <div id="profileLocationDisplay"></div>
              {% else %}
                <div class="alert alert-info">
                  <i class="fas fa-info-circle me-2"></i>
                  Location coordinates not set. 
                  {% if request.user.id == template_data.profile.user.id %}
                    <a href="{% url 'profile.edit' template_data.profile.user.id %}">Edit your profile</a> to pin your exact location on the map.
                  {% endif %}
                </div>
              {% endif %}
            </div>
          </div>
        </div>
      {% endif %}

      {% if template_data.profile.portfolio or template_data.profile.github %}
        <div class="section-header mt-4">
          <i class="fas fa-link"></i>
          Portfolio & Links
        </div>
        <div class="section-content">
          <div class="row">
            {% if template_data.profile.portfolio %}
              <div class="col-md-6 mb-3">
                <div class="card">
                  <div class="card-body text-center">
                    <i class="fas fa-globe fa-2x text-gt-gold mb-3"></i>
                    <h5 class="card-title">Portfolio</h5>
                    <a href="{{ template_data.profile.portfolio }}" target="_blank" class="btn btn-outline-primary">
                      <i class="fas fa-external-link-alt"></i>
                      Visit Portfolio
                    </a>
                  </div>
                </div>
              </div>
            {% endif %}
            {% if template_data.profile.github %}
              <div class="col-md-6 mb-3">
                <div class="card">
                  <div class="card-body text-center">
                    <i class="fab fa-github fa-2x text-gt-gold mb-3"></i>
                    <h5 class="card-title">GitHub</h5>
                    <a href="{{ template_data.profile.github }}" target="_blank" class="btn btn-outline-primary">
                      <i class="fas fa-external-link-alt"></i>
                      View GitHub
                    </a>
                  </div>
                </div>
              </div>
            {% endif %}
          </div>
        </div>
      {% endif %}

      <!-- Job Applications Section -->
      <!-- Recruiter: Jobs Posted Section -->
      {% if template_data.profile.is_recruiter %}
        <div class="section-header mt-4">
          <i class="fas fa-briefcase"></i>
          Jobs Posted
        </div>
        <div class="section-content">
          {% with recruiter_jobs=template_data.jobs_posted %}
            {% if recruiter_jobs %}
              <div class="row">
                {% for job in recruiter_jobs %}
                  <div class="col-lg-6 mb-3">
                    <div class="card">
                      <div class="card-body">
                        <h5 class="card-title text-gt-navy">{{ job.title }}</h5>
                        <h6 class="card-subtitle mb-2 text-muted">{{ job.company }}</h6>

                        <a class="btn btn-primary mt-2"
                          href="{% url 'recruiter_pipeline_job' job.id %}">
                          <i class="fas fa-columns"></i>
                          View Kanban
                        </a>
                      </div>
                    </div>
                  </div>
                {% endfor %}
              </div>
            {% else %}
              <div class="alert alert-info text-center">
                <i class="fas fa-info-circle fa-2x mb-3 text-gt-gold"></i>
                <h5>No jobs posted yet</h5>
                <a class="btn btn-primary mt-2" href="{% url 'job.create' %}">
                  <i class="fas fa-plus"></i>
                  Create Job
                </a>
              </div>
            {% endif %}
          {% endwith %}
        </div>
      {% else %}
        <!-- Normal User: Job Applications -->
        {% if template_data.applications %}
          <div class="section-header mt-4">
            <i class="fas fa-file-alt"></i>
            Job Applications
          </div>
          <div class="section-content">
            <div class="row">
              {% for application in template_data.applications %}
                <div class="col-lg-6 mb-3">
                  <div class="card">
                    <div class="card-body">
                      <h5 class="card-title text-gt-navy">{{ application.job.title }}</h5>
                      <h6 class="card-subtitle text-muted">{{ application.job.company }}</h6>
                      <span class="badge bg-info mb-2">{{ application.get_status_display }}</span>
                      <p class="text-muted small mb-0">
                        <i class="fas fa-calendar text-gt-gold me-1"></i>
                        Applied {{ application.applied_at|date:"M d, Y" }}
                      </p>
                    </div>
                  </div>
                </div>
              {% endfor %}
            </div>
          </div>
        {% endif %}
      {% endif %}
    </div>
  </div>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  {% if template_data.profile.latitude and template_data.profile.longitude %}
  <script>
    // Initialize map with user's location
    const map = L.map('profileLocationDisplay').setView([{{ template_data.profile.latitude }}, {{ template_data.profile.longitude }}], 12);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    // Add marker for user's location
    const userIcon = L.divIcon({
      html: '<i class="fas fa-user" style="color: #B3A369; font-size: 24px;"></i>',
      className: 'user-location-icon',
      iconSize: [30, 30],
      iconAnchor: [15, 15]
    });

    L.marker([{{ template_data.profile.latitude }}, {{ template_data.profile.longitude }}], { icon: userIcon })
      .addTo(map)
      .bindPopup('<div style="text-align: center;"><strong><i class="fas fa-user me-1"></i>{{ template_data.owner.username }}</strong><br><small>{{ template_data.profile.location }}</small></div>')
      .openPopup();
  </script>
  {% endif %}
</body>
</html>
{% endblock content %}